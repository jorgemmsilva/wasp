<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons"><title data-react-helmet="true">State, transitions and state anchoring | IOTA Smart Contract Protocol</title><meta data-react-helmet="true" property="og:url" content="https://iscp.docs.iota.org/docs/guide/core_concepts/states/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="State, transitions and state anchoring | IOTA Smart Contract Protocol"><meta data-react-helmet="true" name="description" content="State of the chain"><meta data-react-helmet="true" property="og:description" content="State of the chain"><link data-react-helmet="true" rel="shortcut icon" href="/img/logo/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://iscp.docs.iota.org/docs/guide/core_concepts/states/"><link data-react-helmet="true" rel="alternate" href="https://iscp.docs.iota.org/docs/guide/core_concepts/states/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://iscp.docs.iota.org/docs/guide/core_concepts/states/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.a6ec2731.css">
<link rel="preload" href="/assets/js/runtime~main.b54827df.js" as="script">
<link rel="preload" href="/assets/js/main.d634752e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo/WASP_logo_dark.png" alt="IOTA" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo/WASP_logo_dark.png" alt="IOTA" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">ISCP</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/welcome/">Documentation</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo/WASP_logo_dark.png" alt="IOTA" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo/WASP_logo_dark.png" alt="IOTA" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">ISCP</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/welcome/">Documentation</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/guide/readme/">Overview</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Core Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/core_concepts/smart-contracts/">Smart Contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/core_concepts/iscp/">ISCP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/core_concepts/iscp-architecture/">ISCP Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/core_concepts/validators/">Committees and Validators</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/core_concepts/consensus/">Consensus</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/guide/core_concepts/states/">State, transitions and state anchoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/core_concepts/core-contracts/">Core Contracts</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Accounts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/core_concepts/accounts/accounts-how/">How accounts work</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/core_concepts/accounts/accounts-deposit/">How to deposit to a chain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/core_concepts/accounts/accounts-withdraw/">How to withdraw from a chain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/core_concepts/accounts/accounts-views/">View account balances</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/core_concepts/accounts/accounts-common-account/">The common account</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Interacting with smart contracts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/core_concepts/smartcontract-interaction/on-ledger/">On-ledger requests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/core_concepts/smartcontract-interaction/off-ledger/">Off-ledger requests</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Types of VMs/Languages</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/core_concepts/vm-types/iscp-vm/">How ISCP works as a language/VM agnostic platform</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Rust/Wasm based smart contracts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/core_concepts/vm-types/rust-wasm/">Why and what does it look like?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/core_concepts/vm-types/rust-wasm/">Solidity/EVM based smart contracts</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Solidity/EVM based smart contracts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/core_concepts/vm-types/evm/">Why and what does it look like?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/core_concepts/vm-types/evm/">Solidity/EVM based smart contracts</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ISCP chains and nodes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/chains_and_nodes/run-node/">Running a node</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/chains_and_nodes/wasp-cli/">Configuring wasp-cli</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/chains_and_nodes/setup/">Setting up a chain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/chains_and_nodes/manage/">Chain Management</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Rust/WASM</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/rust_wasm/readme/">Introduction</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">EVM</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/evm/readme/">Introduction</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/contribute/">Contribute</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Old</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/welcome/">Welcome</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/readme/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/01/">The Solo Package</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/02/">Tokens and the UTXO Ledger</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/03/">Creating a Chain; Core Contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/04/">Deploying and Running a Rust Smart Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/05/">Structure of the Smart Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/06/">Sending a Request</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/07/">Calling a View</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/08/">Deposit and Withdraw Tokens</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/09/">Sending Tokens to a Smart Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/10/">Return Of Tokens in Case of Failure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/11/">Sending Tokens from a Smart Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/12/">ISCP On-Chain Accounts</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Core Contracts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contract_core/overview/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contract_core/root/">Root Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contract_core/accounts/">Accounts Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contract_core/blob/">Blob Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contract_core/blocklog/">Blocklog Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contract_core/governance/">Governance Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contract_core/default/">Default Contract</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Miscellaneous</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/misc/runwasp/">Run a Node</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/misc/deploy/">Deploy with Wasp-CLI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/misc/install/">Install</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/misc/invoking/">Invoke</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/misc/utxo/">UTXO Ledger</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/misc/coretypes/">Core Types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/misc/accounts/">On-Chain Accounts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/misc/publisher/">Wasp Publisher</a></li></ul></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">State, transitions and state anchoring</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="state-of-the-chain"></a>State of the chain<a class="hash-link" href="#state-of-the-chain" title="Direct link to heading">#</a></h2><p>The state of the chain consists of:</p><ul><li>Balances of the native IOTA digital assets, colored tokens. The chain acts as a custodian for those funds</li><li>A collection of arbitrary key/value pairs, the data state, which represents use case-specific data stored in the chain by its smart contracts outside of the UTXO ledger.</li></ul><p>The state of the chain is an append-only (immutable) data structure maintained by the distributed consensus of its validators.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="digital-assets-on-the-chain"></a>Digital assets on the chain<a class="hash-link" href="#digital-assets-on-the-chain" title="Direct link to heading">#</a></h2><p>The native L1 accounts of IOTA UTXO ledger are represented by addresses, each controlled by the entity holding the corresponding private/public key pair. The L1 account is a collection of UTXOs belonging to the address.</p><p>Similarly, the chain holds all tokens entrusted to it in one special UTXO, the state output (see above) which is always located in the address controlled by the chain.
It is similar to how a bank holds all deposits in its vault. This way, the chain (entity controlling the state output) becomes a custodian for the assets owned by its clients, in the same sense the bank’s client owns the money deposited in the bank.</p><p>We call the consolidated assets held in the chain “total assets on-chain”, which are contained in the state output of the chain.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-data-state"></a>The data state<a class="hash-link" href="#the-data-state" title="Direct link to heading">#</a></h2><p>The data state of the chain consists of the collection of key/value pairs. Each key and each value are arbitrary byte arrays.</p><p>In its persistent form, the data state is stored in the key/value database outside of the UTXO ledger and maintained by the validator nodes of the chain.
The state stored in the database is called a solid state.</p><p>The virtual state is a in-memory collection of key/value pairs which can become solid upon being committed to the database. An essential property of the virtual state is the possibility to have several virtual states in parallel as candidates, with a possibility for one of them to be solidified.</p><p>The data state in any form has: a state hash, timestamp and state index.
(State hash is usually a Merkle root but it can be any hashing function of all data contained in the data state)</p><p>The data state and the on-chain assets are both contained in one atomic unit on the ledger: the state UTXO. The state hash can only be changed by the same entity which controls the funds (the committee). So, the state mutation (state transition) of the chain is an atomic event between funds and the data state.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="anchoring-the-state"></a>Anchoring the State<a class="hash-link" href="#anchoring-the-state" title="Direct link to heading">#</a></h2><p>The data state is stored outside of the ledger, on the distributed database maintained by validators nodes.</p><p>By anchoring the state we mean: placing the hash of the data state into one special transaction and one special UTXO (an output) and adding it (confirming) on the UTXO ledger.</p><p>The UTXO ledger guarantees that at every moment there’s <em>exactly one</em> such output for each chain on the UTXO ledger. We call this output the <em>state output</em> (or state anchor) and the containing transaction <em>state transaction</em> (or anchor transaction) of the chain.</p><p>The state output is controlled (i.e. can be unlocked/consumed) by the entity running the chain.</p><p>With the anchoring mechanism the UTXO ledger supports the ISCP chain the following way:</p><ul><li>guarantees global consensus on the state of the chain</li><li>makes the state immutable and tamper-proof</li><li>makes the state consistent (see below)</li></ul><p>The state output contains:</p><ul><li>Identity of the chain (alias address)</li><li>Hash of the data state</li><li>State index, which is incremented with each next state output, the state transition (see below)</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="state-transitions"></a>State Transitions<a class="hash-link" href="#state-transitions" title="Direct link to heading">#</a></h2><p>The Data state is updated by mutations of its key value pairs. Each mutation is either setting a value for a key, or deleting a key (and associeted value). Any update to the data state can be reduced to the partially ordered sequence of mutations.</p><p>The collection of mutations to the data state which is applied in a transition we call a <em>block</em>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">next data state = apply(current data state, block)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <em>state transition</em> in the chain occurs atomically together with the movement of the chain&#x27;s assets and the update of the state hash to the hash of the new data state in the transaction which consumes previous state output and produces next state output.</p><p>At any moment of time, the data state of the chain is a result of applying the historical sequence of blocks, starting from the empty data state. Hence, blockchain.</p><p><img alt="state transitions" src="/assets/images/chain0-70ec82f973cafa300a093a6aa6073ac0.png"></p><p>On the UTXO ledger (L1), the history of the state is represented as a sequence (chain) of UTXOs, each holding chain’s assets in a particular state and the anchoring hash of the data state. Note that not all of the state transitions history may be available: due to practical reasons the older transaction may be pruned in the snapshot process. The only thing that is guaranteed: the tip of the chain of UTXOs is always available (which includes the latest data state).</p><p>The blocks and state outputs which anchor the state are computed by the Virtual Machine (VM), a deterministic processor, a “black box”. The VM is responsible for the consistency of state transition and the state itself.</p><p><img alt="chain" src="/assets/images/chain1-aa95a6d64b6dfecdb71d3280a7a624ae.png"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/iotaledger/chronicle.rs/tree/main/docs/docs/guide/core_concepts/states.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/guide/core_concepts/consensus/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Consensus</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/guide/core_concepts/core-contracts/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">core-contracts »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#state-of-the-chain" class="table-of-contents__link">State of the chain</a></li><li><a href="#digital-assets-on-the-chain" class="table-of-contents__link">Digital assets on the chain</a></li><li><a href="#the-data-state" class="table-of-contents__link">The data state</a></li><li><a href="#anchoring-the-state" class="table-of-contents__link">Anchoring the State</a></li><li><a href="#state-transitions" class="table-of-contents__link">State Transitions</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/welcome/">Welcome</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 IOTA Foundation, Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b54827df.js"></script>
<script src="/assets/js/main.d634752e.js"></script>
</body>
</html>