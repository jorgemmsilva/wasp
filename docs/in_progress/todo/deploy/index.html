<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons"><title data-react-helmet="true">deploy | IOTA Smart Contract Protocol</title><meta data-react-helmet="true" property="og:url" content="https://iscp.docs.iota.org/docs/in_progress/todo/deploy/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="deploy | IOTA Smart Contract Protocol"><meta data-react-helmet="true" name="description" content="Obsolete. To be adjusted to the new version"><meta data-react-helmet="true" property="og:description" content="Obsolete. To be adjusted to the new version"><link data-react-helmet="true" rel="shortcut icon" href="/img/logo/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://iscp.docs.iota.org/docs/in_progress/todo/deploy/"><link data-react-helmet="true" rel="alternate" href="https://iscp.docs.iota.org/docs/in_progress/todo/deploy/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://iscp.docs.iota.org/docs/in_progress/todo/deploy/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.a6ec2731.css">
<link rel="preload" href="/assets/js/runtime~main.b54827df.js" as="script">
<link rel="preload" href="/assets/js/main.d634752e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo/WASP_logo_dark.png" alt="IOTA" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo/WASP_logo_dark.png" alt="IOTA" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">ISCP</b></a><a class="navbar__item navbar__link" href="/docs/welcome/">Documentation</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo/WASP_logo_dark.png" alt="IOTA" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo/WASP_logo_dark.png" alt="IOTA" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">ISCP</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/welcome/">Documentation</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">deploy</h1></header><p><em>Obsolete. To be adjusted to the new version</em></p><hr><header><h1 class="h1Heading_27L5">Committees and deployment of the smart contract</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-committee"></a>The committee<a class="hash-link" href="#the-committee" title="Direct link to heading">#</a></h2><p>Smart contract instance is a <em>dApp</em>, a distributed application or program.
It is run by a distributed network of Wasp nodes called the <em>committee</em>.
A committee, small or big, is behind every smart contract. </p><p>Network locations of the committee nodes are usually not a public information.
The reason is to protect the committee node from DDoS and similar attacks.
In the dashboards of <em>DonateWithFeedback</em> and other PoC smart contracts we display it for demo purposes. </p><p>For example, it shows the <a href="http://waspdev01.iota.cafe:10000/dwf" target="_blank" rel="noopener noreferrer">instance</a> of <em>DonateWithFeedback</em>
is deployed on 5 nodes, <em>TokenRegistry</em> on 10 and <em>FairAuction</em> on 15.
The committees of those 3 instances overlap. Any Wasp node can participate in many committees
of many smart contracts.</p><p>You may think a committee is a distributed processor which runs the smart contract program. </p><p>The committee is specific for each SC instance, depending on how SC is <em>deployed</em>.
It may be as small as 2 nodes, or it may have hundreds of nodes. </p><p>The committee nodes run the program under the <em>distributed consensus</em>.
In the ISCP each committee has specific number less or equal to the size of the committee called <em>quorum</em> or
<em>quorum factor</em>.  The <em>quorum</em> is always strictly larger than the half of the size of the committee.
Very often the quorum is equal to 2/3 plus one node.</p><p>The consensus guarantees that for each computed state update at least the <em>quorum</em> of any committee nodes
have 100% agreement on the computation result.
The <em>state transition</em> can occur only if the condition above is satisfied. </p><p>For example, for the demo deployment of <em>FairAuction</em> smart contract the quorum factor is set to 8.
It means at least 8 out of 15 nodes must produce and sign with their private keys bit-by-bit equal computation
results for that result to be accepted as a valid smart contract state update. </p><p>After the quorum agrees on the result, the opinion of the rest of nodes is unimportant:
those nodes may be down, faulty or malicious.
The quorum already has consensus on which requests to process and in which order, to where and
how to move tokens and update the values of the smart contract state. The quorum agrees on the same view to many things,
like the UTXO ledger, which one committee node is a leader for the round, what is the timestamp consistent
with the local clocks of each node and which node will receive rewards (if the smart contract instance requires fees).</p><p>After the committee runs the program to process the request to the smart contract, it comes to
the consensus on the result and posts the result transaction to the Tangle.</p><p>In order to fake the result, for example to steal iotas (to move them to the attackerâ€™s address), at least
a quorum of committee nodes must be corrupted. It is not feasible in most practical use cases with
committee size and quorum large enough.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="selecting-the-committee"></a>Selecting the committee<a class="hash-link" href="#selecting-the-committee" title="Direct link to heading">#</a></h3><p>The committee is crucial for the security of the smart contract. </p><p>The topic of committee formation is very broad, and we do not intend to cover it all here.</p><p>The policies and protocol for committee selection may be centralized or it may be based on
permissionless participation of nodes in an open market of nodes.</p><p>Centralized selection of committee nodes is common for corporate setting or in the consortium (in latter case
it actually will essentially be decentralized).</p><p>Committee may be selected in the open market where everyone participates in the parmissionless manner.
In this case nodes may be selected (by whoever is forming the committee) based on committment of the node
owners to SLA and other criteria. Trust to such a committee will be ensured by requiring stakes from the committee
nodes and setting up automatic punishment, including complete slashing of the stake,
for not complying to SLA and other misbehavior.    </p><p>Note that at this stage we intentionally leave the committee selection policies and protocols outside of the
ISCP itself because we want variety here. It is an important scope of further development of ISCP. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="deploying-a-smart-contract"></a>Deploying a smart contract<a class="hash-link" href="#deploying-a-smart-contract" title="Direct link to heading">#</a></h2><p>Let&#x27;s say we have committee nodes already selected (see above). </p><p>We have to provide the following input to the deployment process:</p><ul><li>the <em>program hash</em> (see on program hash <a href="/docs/in_progress/todo/dwf/">here</a>), which points to the program binary  </li><li>the sorted list of committee nodes</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="deploy-a-new-instance-of-donatewithfeedback"></a>Deploy a new instance of <em>DonateWithFeedback</em><a class="hash-link" href="#deploy-a-new-instance-of-donatewithfeedback" title="Direct link to heading">#</a></h2><p>We will deploy <em>DonateWithFeedback</em> using <code>wasp-cli</code> program. </p><p>For the <em>DonateWithFeedback</em> the program hash is equal to <code>5ydEfDeAJZX6dh6Fy7tMoHcDeh42gENeqVDASGWuD64X</code>.
It points to the code statically linked with the Wasp node.
In the particular case of PoC smart contracts the <code>wasp-cli</code> knows and derives the program hash from the <code>dwf</code> keyword
in the command line.  </p><p>The list of committee nodes must be listed in the respective <code>dwf</code> section of <code>wasp-cli.json</code>, in the current directory.
Download example of <code>wasp-cli.json</code> via link in the demo dashboard.</p><p>The balance of the wallet must have at least 2 iotas in order to deploy smart contract. One of these iotas will be
minted (colored) to a new non-fungible token transferred to the smart contract address.
It will remain there for its lifetime. Another iota will be returned back to the owner&#x27;s balance after
SC instance will be fully intialized.</p><p>The following command will deploy an instance of <em>DonateWithFeedback</em> smart contract on the committee
specified in the <code>wasp-cli.json</code>:</p><p><code>wasp-cli dwf admin deploy</code> </p><p>If successful, the program will print the address of the newly deployed instance among other things.
From now on anyone can send <code>donate</code> requests to that address. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="deployment-process-in-detail"></a>Deployment process in detail<a class="hash-link" href="#deployment-process-in-detail" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-owner"></a>The owner<a class="hash-link" href="#the-owner" title="Direct link to heading">#</a></h3><p>The initiator of the deployment process is the owner of the wallet (the private key) and hence the tokens in the
wallet&#x27;s address. The owner of the wallet becomes the <code>owner of the SC</code> as it performs the deployment
using his/her wallet.
This ensures that for the smart contract the owner is authenticated and therefore known. </p><p>The owner address of the SC becomes a privileged user of the smart contract.
It is the only address which can send <em>protected requests</em> to the smart contract.
For the <em>DonateWithFeedback</em> smart contract, the SC owner is the only one who can withdraw
iotas from its account by sending <code>withdraw</code> request. Requests send by any other sender will have no effect.</p><p>Note that an owner in general doesn&#x27;t <em>own</em> anything which belongs to SC account.
It is just a privileged user, recognized as such at the base protocol.
The smart contract program may or may not treat it as privileged, depending on its algorithms.
Ownership of the smart contract can be transferred (this feature not implemented yet in PoC).     </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dkg-and-the-origin-transaction"></a>DKG and the origin transaction<a class="hash-link" href="#dkg-and-the-origin-transaction" title="Direct link to heading">#</a></h3><p>Deployment of the smart contract consists of two main steps: </p><ul><li><em>distributed key generation</em> (DKG) </li><li>creating the <em>origin transaction</em>.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dkg"></a>DKG<a class="hash-link" href="#dkg" title="Direct link to heading">#</a></h4><p>The purpose of the DKG is to generate a set of private keys among committee nodes in a distributed and secure manner.
The process is triggered by the owner of the smart contract during deployment and then it is
performed between committee nodes, in a distributed and leaderless manner. </p><p>The result is a set of private keys,
the master public key and the smart contract address, controlled by the quorum of private keys
(partial keys or key shares). </p><p>The quorum parameter T is an input parameter of the DKG process. The private keys are stored in each node&#x27;s registry.
In the future we plan to use hardware instances with IOTA Stronghold in it.</p><p>The base scenario of DKG is a completely decentralized one.
It results in private keys only known by the committee nodes.</p><p>However, in many practical situations it may be needed for example to have possibility make backup copies
of critical data or even take certain decisions on behalf of the committee
(like move the SC instance to another committee). These situations may be common when we use
centralized consensus on the committee during deployment.  </p><p>In these alternative situations DKG process may provide master private key or even backup of
all private keys to the owner of the SC instance in secure manner.
In any case, these settings are parameters of the protocol known to each Wasp node which is
participating in DKG, so private keys can only be shared with the consensus of all nodes.  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-origin-transaction-color-of-the-smart-contract"></a>The <em>origin transaction</em>. Color of the smart contract<a class="hash-link" href="#the-origin-transaction-color-of-the-smart-contract" title="Direct link to heading">#</a></h4><p>After the private keys and the smart contract address are generated and stored by the committee nodes,
the <em>origin transaction</em> of the smart contract must be created on the Tangle. </p><p>The <em>origin transaction</em> is a value transaction with certain data payload (a smart contract transaction)
signed by the owner of the smart contract with its private key. </p><p>With the origin transaction the owner mints 1 new token and transfers it to the smart contract address.
The resulting <em>non-fungible</em> (unique) token takes the hash of the origin transaction as its <em>color code</em>.</p><p>The new colored token is the <em>smart contract token</em>. The <em>smart contract token</em> remains in the smart contract
address as long as the smart contract is using this address, i.e. normally for the lifetime.</p><p>The color code of the <em>smart contract token</em> is equal to the hash of the origin
transaction. It is called <em>color of the smart contract</em>.</p><p>You may find <em>color</em> of the instance in the demo dashboard of the <em>DonateWithFeedback</em> smart contract.
You will also find exactly 1 token with the color equal to the smart contract color
in the balances of the smart contract.</p><p>The non-fungible <em>smart contract token</em> guarantees there is exactly 1 transaction
and exactly 1 UTXO with this token on the ledger globally.
This property prevents <em>forking</em> the chain of state updates, i.e. there&#x27;s always unique and objective SC state. </p><p>The color of the smart contract remains the same during the lifetime of the smart contract.
In some situations a smart contract with its state may be moved to another address.
In that case the address of the smart contract will change, and the <em>smart contract token</em> will be moved to it.
So, the color of the smart contract (the color of the token) will remain the same for its lifetime
even if the address will change. Therefore, the color of the instance is an ultimate identity of
it on the global ledger.</p><p>The owner of the smart contract mints the smart contract token and therefore becomes authenticated and singled
out participant in the smart contract since the origin.
This makes the owner to be a privileged user of the smart contract: the builtin logic of the smart contract will
process privileged request codes only if sent from the ownerâ€™s address.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/iotaledger/chronicle.rs/tree/main/docs/docs/in_progress/todo/deploy.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-committee" class="table-of-contents__link">The committee</a><ul><li><a href="#selecting-the-committee" class="table-of-contents__link">Selecting the committee</a></li></ul></li><li><a href="#deploying-a-smart-contract" class="table-of-contents__link">Deploying a smart contract</a></li><li><a href="#deploy-a-new-instance-of-donatewithfeedback" class="table-of-contents__link">Deploy a new instance of <em>DonateWithFeedback</em></a></li><li><a href="#deployment-process-in-detail" class="table-of-contents__link">Deployment process in detail</a><ul><li><a href="#the-owner" class="table-of-contents__link">The owner</a></li><li><a href="#dkg-and-the-origin-transaction" class="table-of-contents__link">DKG and the origin transaction</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/welcome/">Welcome</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 IOTA Foundation, Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b54827df.js"></script>
<script src="/assets/js/main.d634752e.js"></script>
</body>
</html>